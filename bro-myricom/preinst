#!/bin/sh

set -e

case "$1" in
    install|upgrade)
    
	# Backup files from 2.3
        if [ -d /opt/bro/etc ]; then
		mkdir -p /opt/bro/etc_2.3/
		cp -a /opt/bro/etc/* /opt/bro/etc_2.3/ || echo "Unable to backup /opt/bro/etc/."
        fi
	
        if [ -f /opt/bro/share/bro/site/local.bro ]; then
		cp /opt/bro/share/bro/site/local.bro /opt/bro/share/bro/site/local.bro.2.3 || echo "Unable to backup local.bro."
        fi

	# Stop bro
	#if pgrep -f /opt/bro/bin/bro >/dev/null 2>&1; then
	#	/opt/bro/bin/broctl stop || echo "Unable to stop Bro."
	#fi
        
    ;;

    abort-upgrade)
    ;;

    *)
        echo "preinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
